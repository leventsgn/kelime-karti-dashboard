<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resimli Kelime Oyunu</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #fefefe;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: #14b8a6;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        main {
            flex: 1;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .question {
            font-size: 1.4rem;
            margin: 1rem 0;
            text-align: center;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            width: 100%;
            max-width: 600px;
            margin-bottom: 1rem;
        }
        .image-option {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s;
            height: 0;
            padding-bottom: 70%; /* maintain aspect ratio */
        }
        .image-option img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-option.correct {
            border-color: #10b981;
        }
        .image-option.wrong {
            border-color: #f87171;
        }
        .return-btn {
            margin-top: 2rem;
            padding: 0.6rem 1.2rem;
            font-size: 1rem;
            border-radius: 8px;
            border: none;
            background-color: #14b8a6;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <h1>Resimli Kelime Oyunu</h1>
    </header>
    <main>
        <p class="question" id="questionText"></p>
        <div class="image-grid" id="imageGrid"></div>
        <button class="return-btn" onclick="goHome()">Ana Sayfaya Dön</button>
    </main>

    <script>
    // Same expanded card list as other pages
    const initialCards = [
        // A1
        { id: 1, word: 'apple', translation: 'elma', example: 'I eat an apple every day.', level: 'A1', stage: 1 },
        { id: 2, word: 'sun', translation: 'güneş', example: 'The sun is shining.', level: 'A1', stage: 1 },
        { id: 3, word: 'book', translation: 'kitap', example: 'This book is interesting.', level: 'A1', stage: 1 },
        { id: 4, word: 'city', translation: 'şehir', example: 'I live in a large city.', level: 'A1', stage: 1 },
        { id: 5, word: 'dog', translation: 'köpek', example: 'The dog is barking.', level: 'A1', stage: 1 },
        { id: 6, word: 'house', translation: 'ev', example: 'My house is big.', level: 'A1', stage: 1 },
        { id: 7, word: 'cat', translation: 'kedi', example: 'The cat is sleeping.', level: 'A1', stage: 1 },
        { id: 8, word: 'car', translation: 'araba', example: 'I have a new car.', level: 'A1', stage: 1 },
        { id: 9, word: 'school', translation: 'okul', example: 'She goes to school every day.', level: 'A1', stage: 1 },
        { id: 10, word: 'water', translation: 'su', example: 'Drink some water.', level: 'A1', stage: 1 },
        { id: 11, word: 'table', translation: 'masa', example: 'There is a book on the table.', level: 'A1', stage: 1 },
        { id: 12, word: 'chair', translation: 'sandalye', example: 'The chair is comfortable.', level: 'A1', stage: 1 },
        { id: 13, word: 'milk', translation: 'süt', example: 'I drink milk every morning.', level: 'A1', stage: 1 },
        { id: 14, word: 'coffee', translation: 'kahve', example: 'She likes strong coffee.', level: 'A1', stage: 1 },
        { id: 15, word: 'banana', translation: 'muz', example: 'Monkeys love bananas.', level: 'A1', stage: 1 },
        { id: 16, word: 'orange', translation: 'portakal', example: 'Can I have an orange?', level: 'A1', stage: 1 },
        // A2
        { id: 17, word: 'family', translation: 'aile', example: 'My family is very supportive.', level: 'A2', stage: 1 },
        { id: 18, word: 'friend', translation: 'arkadaş', example: 'He is my best friend.', level: 'A2', stage: 1 },
        { id: 19, word: 'travel', translation: 'seyahat', example: 'They love to travel.', level: 'A2', stage: 1 },
        { id: 20, word: 'job', translation: 'iş', example: 'I start my new job tomorrow.', level: 'A2', stage: 1 },
        { id: 21, word: 'music', translation: 'müzik', example: 'We listen to music.', level: 'A2', stage: 1 },
        { id: 22, word: 'food', translation: 'yiyecek', example: 'The food tastes great.', level: 'A2', stage: 1 },
        { id: 23, word: 'weather', translation: 'hava', example: 'The weather is nice today.', level: 'A2', stage: 1 },
        { id: 24, word: 'computer', translation: 'bilgisayar', example: 'I bought a new computer.', level: 'A2', stage: 1 },
        { id: 25, word: 'phone', translation: 'telefon', example: 'My phone is ringing.', level: 'A2', stage: 1 },
        { id: 26, word: 'garden', translation: 'bahçe', example: 'The garden is full of flowers.', level: 'A2', stage: 1 },
        { id: 27, word: 'restaurant', translation: 'restoran', example: 'We had dinner at a restaurant.', level: 'A2', stage: 1 },
        { id: 28, word: 'holiday', translation: 'tatil', example: 'They went on holiday last week.', level: 'A2', stage: 1 },
        { id: 29, word: 'supermarket', translation: 'süpermarket', example: 'I buy groceries at the supermarket.', level: 'A2', stage: 1 },
        { id: 30, word: 'movie', translation: 'film', example: 'We watched a movie last night.', level: 'A2', stage: 1 },
        { id: 31, word: 'sport', translation: 'spor', example: 'Football is my favourite sport.', level: 'A2', stage: 1 },
        { id: 32, word: 'doctor', translation: 'doktor', example: 'I need to see a doctor.', level: 'A2', stage: 1 },
        { id: 33, word: 'hospital', translation: 'hastane', example: 'She works at the hospital.', level: 'A2', stage: 1 },
        { id: 34, word: 'library', translation: 'kütüphane', example: 'Students study at the library.', level: 'A2', stage: 1 },
        { id: 35, word: 'hotel', translation: 'otel', example: 'We stayed at a hotel.', level: 'A2', stage: 1 },
        { id: 36, word: 'airport', translation: 'havaalanı', example: 'He arrived at the airport.', level: 'A2', stage: 1 },
        // B1
        { id: 37, word: 'environment', translation: 'çevre', example: 'Protecting the environment is important.', level: 'B1', stage: 1 },
        { id: 38, word: 'culture', translation: 'kültür', example: 'The city has a rich culture.', level: 'B1', stage: 1 },
        { id: 39, word: 'economy', translation: 'ekonomi', example: 'The economy is growing.', level: 'B1', stage: 1 },
        { id: 40, word: 'education', translation: 'eğitim', example: 'Education opens doors.', level: 'B1', stage: 1 },
        { id: 41, word: 'language', translation: 'dil', example: 'Language connects people.', level: 'B1', stage: 1 },
        { id: 42, word: 'technology', translation: 'teknoloji', example: 'Technology is advancing rapidly.', level: 'B1', stage: 1 },
        { id: 43, word: 'health', translation: 'sağlık', example: 'Health is wealth.', level: 'B1', stage: 1 },
        { id: 44, word: 'community', translation: 'toplum', example: 'The community is supportive.', level: 'B1', stage: 1 },
        { id: 45, word: 'energy', translation: 'enerji', example: 'Solar energy is renewable.', level: 'B1', stage: 1 },
        { id: 46, word: 'science', translation: 'bilim', example: 'Science explains how things work.', level: 'B1', stage: 1 },
        { id: 47, word: 'history', translation: 'tarih', example: 'History teaches us about the past.', level: 'B1', stage: 1 },
        { id: 48, word: 'business', translation: 'iş dünyası', example: 'She studies business.', level: 'B1', stage: 1 },
        { id: 49, word: 'project', translation: 'proje', example: 'We are working on a new project.', level: 'B1', stage: 1 },
        { id: 50, word: 'research', translation: 'araştırma', example: 'He is doing research.', level: 'B1', stage: 1 },
        { id: 51, word: 'communication', translation: 'iletişim', example: 'Communication is key.', level: 'B1', stage: 1 },
        { id: 52, word: 'opinion', translation: 'görüş', example: 'Everyone has an opinion.', level: 'B1', stage: 1 },
        // B2
        { id: 53, word: 'government', translation: 'hükümet', example: 'The government passed a new law.', level: 'B2', stage: 1 },
        { id: 54, word: 'opportunity', translation: 'fırsat', example: 'Education provides opportunity.', level: 'B2', stage: 1 },
        { id: 55, word: 'relationship', translation: 'ilişki', example: 'Trust is important in a relationship.', level: 'B2', stage: 1 },
        { id: 56, word: 'experience', translation: 'deneyim', example: 'Work experience matters.', level: 'B2', stage: 1 },
        { id: 57, word: 'development', translation: 'gelişim', example: 'Personal development is essential.', level: 'B2', stage: 1 },
        { id: 58, word: 'psychology', translation: 'psikoloji', example: 'She studies psychology.', level: 'B2', stage: 1 },
        { id: 59, word: 'philosophy', translation: 'felsefe', example: 'Philosophy questions existence.', level: 'B2', stage: 1 },
        { id: 60, word: 'architecture', translation: 'mimari', example: 'Modern architecture is fascinating.', level: 'B2', stage: 1 },
        { id: 61, word: 'democracy', translation: 'demokrasi', example: 'Democracy encourages participation.', level: 'B2', stage: 1 },
        { id: 62, word: 'entrepreneur', translation: 'girişimci', example: 'She is a successful entrepreneur.', level: 'B2', stage: 1 },
        { id: 63, word: 'globalization', translation: 'küreselleşme', example: 'Globalization connects economies.', level: 'B2', stage: 1 },
        { id: 64, word: 'sustainability', translation: 'sürdürülebilirlik', example: 'Sustainability is crucial for our planet.', level: 'B2', stage: 1 },
        { id: 65, word: 'innovation', translation: 'yenilik', example: 'Innovation drives progress.', level: 'B2', stage: 1 },
        { id: 66, word: 'negotiation', translation: 'müzakere', example: 'They reached an agreement after negotiation.', level: 'B2', stage: 1 },
        { id: 67, word: 'hypothesis', translation: 'hipotez', example: 'The scientist tested the hypothesis.', level: 'B2', stage: 1 },
        { id: 68, word: 'analysis', translation: 'analiz', example: 'Data analysis is important.', level: 'B2', stage: 1 },
        { id: 69, word: 'strategy', translation: 'strateji', example: 'They discussed the marketing strategy.', level: 'B2', stage: 1 },
        { id: 70, word: 'ethics', translation: 'etik', example: 'Ethics guide our actions.', level: 'B2', stage: 1 },
        { id: 71, word: 'biodiversity', translation: 'biyoçeşitlilik', example: 'Biodiversity is important for ecosystems.', level: 'B2', stage: 1 },
        { id: 72, word: 'climate', translation: 'iklim', example: 'The climate is changing.', level: 'B2', stage: 1 },
        { id: 73, word: 'biology', translation: 'biyoloji', example: 'Biology studies living organisms.', level: 'B2', stage: 1 },
        { id: 74, word: 'chemistry', translation: 'kimya', example: 'Chemistry experiments can be fun.', level: 'B2', stage: 1 },
        { id: 75, word: 'engineering', translation: 'mühendislik', example: 'Engineering solves practical problems.', level: 'B2', stage: 1 },
        { id: 76, word: 'mathematics', translation: 'matematik', example: 'Mathematics is the language of science.', level: 'B2', stage: 1 },
        { id: 77, word: 'literature', translation: 'edebiyat', example: 'She loves English literature.', level: 'B2', stage: 1 },
        { id: 78, word: 'geography', translation: 'coğrafya', example: 'Geography studies the Earth.', level: 'B2', stage: 1 },
        { id: 79, word: 'statistics', translation: 'istatistik', example: 'Statistics helps us understand data.', level: 'B2', stage: 1 },
        { id: 80, word: 'automation', translation: 'otomasyon', example: 'Automation improves efficiency.', level: 'B2', stage: 1 },
    ];

    function loadProgress() {
        const saved = localStorage.getItem('wordGardenProgress');
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                return initialCards.map(card => {
                    const savedCard = parsed.find(c => c.id === card.id);
                    return savedCard ? { ...card, stage: savedCard.stage } : { ...card };
                });
            } catch (e) {
                console.error('Error parsing saved progress', e);
            }
        }
        return initialCards.map(card => ({ ...card }));
    }

    function saveProgress(cards) {
        localStorage.setItem('wordGardenProgress', JSON.stringify(cards));
    }

    function loadSettings() {
        const saved = localStorage.getItem('wordGardenSettings');
        if (saved) {
            try {
                return JSON.parse(saved);
            } catch (e) {
                console.error('Error parsing settings', e);
            }
        }
        return { level: 'All', dailyGoal: 10 };
    }

    let cards = loadProgress();
    let quizCards = [];
    let currentIndex = 0;
    let currentCard = null;
    const questionText = document.getElementById('questionText');
    const imageGrid = document.getElementById('imageGrid');

    function shuffle(array) {
        const arr = array.slice();
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    /**
     * Start the picture quiz: pick a subset of cards based on level and stage.
     */
    function startQuiz() {
        const settings = loadSettings();
        const available = cards.filter(c => c.stage < 5 && (settings.level === 'All' || c.level === settings.level));
        // If there are fewer than 4 available cards, use all of them
        const count = Math.min(available.length, 8);
        quizCards = shuffle(available).slice(0, count);
        currentIndex = 0;
        if (quizCards.length === 0) {
            questionText.textContent = 'Seçtiğiniz seviyede resimli oyun için uygun kart bulunamadı!';
        } else {
            showNextQuestion();
        }
    }

    /**
     * Display the next word and its image options.
     */
    function showNextQuestion() {
        if (currentIndex >= quizCards.length) {
            questionText.textContent = 'Tebrikler! Tüm resimli soruları tamamladınız.';
            imageGrid.innerHTML = '';
            saveProgress(cards);
            return;
        }
        currentCard = quizCards[currentIndex];
        questionText.textContent = `${currentCard.word} kelimesine uygun görseli seçin`;
        // Prepare options: correct card + three random other cards
        const otherCards = cards.filter(c => c.id !== currentCard.id);
        const randomOthers = shuffle(otherCards).slice(0, 3);
        const options = shuffle([currentCard, ...randomOthers]);
        imageGrid.innerHTML = '';
        options.forEach(option => {
            const div = document.createElement('div');
            div.className = 'image-option';
            // Use Unsplash source to fetch random picture related to the word
            const img = document.createElement('img');
            img.src = `https://source.unsplash.com/300x300/?${encodeURIComponent(option.word)}`;
            img.alt = option.word;
            div.appendChild(img);
            div.addEventListener('click', () => handleSelect(div, option));
            imageGrid.appendChild(div);
        });
    }

    /**
     * Handle image selection by the user.
     */
    function handleSelect(div, option) {
        // prevent multiple selections
        const alreadySelected = imageGrid.querySelector('.image-option.correct, .image-option.wrong');
        if (alreadySelected) return;
        if (option.id === currentCard.id) {
            div.classList.add('correct');
            currentCard.stage = Math.min(currentCard.stage + 1, 5);
        } else {
            div.classList.add('wrong');
            currentCard.stage = Math.max(currentCard.stage - 1, 1);
        }
        // Update global progress
        const idx = cards.findIndex(c => c.id === currentCard.id);
        if (idx >= 0) cards[idx].stage = currentCard.stage;
        // highlight correct option if wrong selected
        if (option.id !== currentCard.id) {
            // find correct option element
            const children = imageGrid.children;
            for (const child of children) {
                const imgAlt = child.querySelector('img').alt;
                if (imgAlt === currentCard.word) {
                    child.classList.add('correct');
                    break;
                }
            }
        }
        // Wait a moment then proceed
        setTimeout(() => {
            currentIndex++;
            showNextQuestion();
        }, 1000);
    }

    function goHome() {
        window.location.href = 'index.html';
    }

    // Initialize quiz on load
    startQuiz();
    </script>
</body>
</html>